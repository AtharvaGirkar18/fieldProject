<!DOCTYPE html>
<html lang="<%= locale %>">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= __('Update Account') %> - Signal Shala</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50">
    <%- include('partials/navbar', currUser) %>

    <div class="max-w-4xl mx-auto px-4 py-8">
      <div class="bg-white rounded-lg shadow-md p-6 md:p-8">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">
          <%= __('Account Settings') %>
        </h1>

        <% if (typeof error !== 'undefined' && error) { %>
        <div
          class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"
        >
          <%= error %>
        </div>
        <% } %> <% if (typeof success !== 'undefined' && success) { %>
        <div
          class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"
        >
          <%= success %>
        </div>
        <% } %>

        <!-- Profile Picture Section -->
        <form
          action="/account/update-picture"
          method="POST"
          enctype="multipart/form-data"
          class="mb-8 pb-8 border-b border-gray-200"
        >
          <h2 class="text-xl font-semibold text-gray-700 mb-4">
            <%= __('Profile Picture') %>
          </h2>

          <div class="flex items-center gap-6 mb-4">
            <img
              src="<%= currUser.picture.path %>"
              alt="Current Profile"
              class="w-24 h-24 rounded-full border-2 border-gray-300 shadow-md"
            />
            <div class="flex-1">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <%= __('Upload New Picture') %>
              </label>
              <input
                type="file"
                name="photo"
                accept="image/*"
                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100 cursor-pointer"
              />
            </div>
          </div>

          <button
            type="submit"
            class="bg-red-500 text-white px-6 py-2 rounded-md hover:bg-red-600 transition-colors"
          >
            <%= __('Update Picture') %>
          </button>
        </form>

        <!-- Username Section -->
        <form
          action="/account/update-username"
          method="POST"
          class="mb-8 pb-8 border-b border-gray-200"
        >
          <h2 class="text-xl font-semibold text-gray-700 mb-4">
            <%= __('Username') %>
          </h2>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <%= __('Current Username') %>
            </label>
            <p class="text-gray-600 bg-gray-100 px-4 py-2 rounded-md">
              <%= currUser.username %>
            </p>
          </div>

          <div class="mb-4">
            <label
              for="newUsername"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              <%= __('New Username') %>
            </label>
            <input
              type="text"
              id="newUsername"
              name="newUsername"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent"
            />
          </div>

          <button
            type="submit"
            class="bg-red-500 text-white px-6 py-2 rounded-md hover:bg-red-600 transition-colors"
          >
            <%= __('Update Username') %>
          </button>
        </form>

        <!-- Password Section -->
        <form action="/account/update-password" method="POST">
          <h2 class="text-xl font-semibold text-gray-700 mb-4">
            <%= __('Change Password') %>
          </h2>

          <div class="mb-4">
            <label
              for="oldPassword"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              <%= __('Current Password') %>
            </label>
            <input
              type="password"
              id="oldPassword"
              name="oldPassword"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent"
            />
          </div>

          <div class="mb-4">
            <label
              for="newPassword"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              <%= __('New Password') %>
            </label>
            <input
              type="password"
              id="newPassword"
              name="newPassword"
              required
              minlength="6"
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent"
            />
          </div>

          <div class="mb-4">
            <label
              for="confirmPassword"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              <%= __('Confirm New Password') %>
            </label>
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              required
              minlength="6"
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent"
            />
          </div>

          <button
            type="submit"
            class="bg-red-500 text-white px-6 py-2 rounded-md hover:bg-red-600 transition-colors"
          >
            <%= __('Change Password') %>
          </button>
        </form>
      </div>
    </div>

    <script>
      // Password confirmation validation
      document
        .querySelector('form[action="/account/update-password"]')
        .addEventListener("submit", function (e) {
          const newPassword = document.getElementById("newPassword").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;

          if (newPassword !== confirmPassword) {
            e.preventDefault();
            alert('<%= __("Passwords do not match") %>');
          }
        });
    </script>
  </body>
</html>
